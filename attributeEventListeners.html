<!DOCTYPE html>
<html lang="en">

<head>
    <title>Attribute Event Listeners</title>

    <script type="module" src="https://devplat.tableautest.com/javascripts/api/tableau.embedding.3.4.0.js"></script>
    <script>
        // An event raised when the size of the viz is known. You can use this event to perform tasks such as resizing the elements surrounding the Viz object once the object's size has been established.
        function handleFirstVizSizeKnown(e) {
            if (e == null) {
                console.log("Event handleFirstVizSizeKnown has no event object.");
                return;
            }

            let size = e.detail.vizSize;
            console.log("---handleFirstVizSizeKnown---");
            console.log(e);
            console.log("---Size---");
            console.log(size);
        }

        // An event raised when the Viz object first becomes interactive. This is only raised once.
        async function handleFirstInteractive(e) {
            if (e == null) {
                console.log("Event FirstInteractive has no event object.");
                return;
            }

            console.log("---handleFirstInteractive---");
            console.log("Viz Embedding Successful!");
        }

        // An event raised after a tab switch occurs (the active sheet has changed). Guarantees the viz object will be interactive after this.
        async function handleTabSwitch(e) {
            if (e == null) {
                console.log("Event TabSwitched has no event object.");
                return;
            }

            // Example that shows getting the viz object from the interactive event.
            let viz = e.target;
            if (viz == null) {
                console.log("Event TabSwitched didn't have a viz object?");
                return;
            }

            let name = viz.workbook.activeSheet.name;
            console.log("---handleTabSwitch---");
            console.log(`Tab switched to ${name}.`);
        }

        // An event raised when a toolbar button or control becomes available or becomes unavailable.
        async function handleToolbarStateChanged(e) {
            if (e == null) {
                console.log('Event handleToolbarStateChanged has no event object.');
                return;
            }

            console.log("---handleToolbarStateChanged---");
            console.log(`canRedo: ${e.detail.canRedo}`);
            console.log(`canUndo: ${e.detail.canUndo}`);
        }
    </script>
</head>

<body>
    <div>
        <div>
            <!-- Add event handlers as attributes to tableau-viz -->
            <tableau-viz id="tableauViz" src="https://devplat.tableautest.com/views/RegionalSampleWorkbook/Flights"
                onFirstVizSizeKnown="handleFirstVizSizeKnown" onFirstInteractive="handleFirstInteractive"
                onToolbarStateChanged="handleToolbarStateChanged" onTabSwitched="handleTabSwitch">
            </tableau-viz>
        </div>
        <div>
            <h3>Output</h3>
            <i> See the console for more information about each event.</i>
        </div>
    </div>
</body>

</html>